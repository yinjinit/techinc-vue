{"version":3,"sources":["webpack:///./src/components/filter/TimeLineExt.vue?d94e","webpack:///src/components/filter/TimeLineExt.vue","webpack:///./src/components/filter/TimeLineExt.vue?8381","webpack:///./src/components/filter/TimeLineExt.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","directives","name","rawName","value","expression","attrs","staticClass","id","timeRange","start","end","on","$event","updateTimeRange","staticRenderFns","x","d3","y","data","undefined","component","VSheet","VToolbar","Resize"],"mappings":"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","file":"js/chunk-2d229417.7db1791e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-sheet',{directives:[{name:\"resize\",rawName:\"v-resize\",value:(_vm.resize),expression:\"resize\"}],attrs:{\"color\":\"rgba(0,0,0,0)\"}},[_c('div',{staticClass:\"ma-4 mb-0\",attrs:{\"id\":_vm.id}}),_c('v-toolbar',{attrs:{\"flat\":\"\",\"tag\":\"div\",\"color\":\"rgba(0,0,0,0)\"}},[_c('date-time-picker',{staticClass:\"mr-1\",attrs:{\"datetime\":_vm.timeRange.start,\"max\":_vm.timeRange.end},on:{\"update:datetime\":function($event){return _vm.updateTimeRange('start', $event)}}}),_c('date-time-picker',{attrs:{\"datetime\":_vm.timeRange.end,\"min\":_vm.timeRange.start},on:{\"update:datetime\":function($event){return _vm.updateTimeRange('end', $event)}}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <v-sheet\r\n    v-resize=\"resize\"\r\n    color=\"rgba(0,0,0,0)\"\r\n  >\r\n    <div\r\n      :id=\"id\"\r\n      class=\"ma-4 mb-0\"\r\n    />\r\n\r\n    <v-toolbar\r\n      flat\r\n      tag=\"div\"\r\n      color=\"rgba(0,0,0,0)\"\r\n    >\r\n      <date-time-picker\r\n        :datetime=\"timeRange.start\"\r\n        :max=\"timeRange.end\"\r\n        class=\"mr-1\"\r\n        @update:datetime=\"updateTimeRange('start', $event)\"\r\n      />\r\n      <date-time-picker\r\n        :datetime=\"timeRange.end\"\r\n        :min=\"timeRange.start\"\r\n        @update:datetime=\"updateTimeRange('end', $event)\"\r\n      />\r\n    </v-toolbar>\r\n  </v-sheet>\r\n</template>\r\n\r\n<script>\r\n  import * as d3 from 'd3'\r\n\r\n  export default {\r\n    name: 'TimeLineExt',\r\n    components: {\r\n      DateTimePicker: () => import('@/components/base/DateTimePicker'),\r\n    },\r\n    data: () => ({\r\n      id: 'timeline-filter',\r\n      x: d3.scaleUtc(),\r\n      y: d3.scaleLinear(),\r\n      data: undefined,\r\n    }),\r\n    computed: {\r\n      timeRange: {\r\n        get () {\r\n          return this.$store.state[this.$route.name].timeRange\r\n        },\r\n        set (val) {\r\n          const name = this.$route.name\r\n          this.$store.commit('SET_TIMERANGE', { name, val })\r\n        },\r\n      },\r\n    },\r\n    mounted () {\r\n      this.draw()\r\n    },\r\n    updated () {\r\n      this.update()\r\n    },\r\n    methods: {\r\n      updateTimeRange (el, val) {\r\n        this.$set(this.timeRange, el, val)\r\n      },\r\n      resize () {\r\n        if (this.data === undefined) return\r\n\r\n        const width = document.querySelector('#' + this.id)\r\n          .getBoundingClientRect().width\r\n        const barWid = Math.round(width / this.data.length)\r\n\r\n        this.x.rangeRound([0, width])\r\n\r\n        const svg = d3.select('svg.' + this.id)\r\n          .attr('width', width)\r\n\r\n        svg.select(`#${this.id} .axis`).call(d3.axisBottom(this.x))\r\n        svg.selectAll(`#${this.id} .bar`)\r\n          .attr('d', d => d.map(e => 'M' + this.x(e.key) + ',114' +\r\n            'V' + this.y(e.value) + 'h' + barWid + 'V114').join(''))\r\n      },\r\n      update () {\r\n        const id = '#' + this.id\r\n        const mBottom = 20\r\n        const width = document.querySelector(id)\r\n          .getBoundingClientRect().width\r\n        const height = 134\r\n        const interval = 20\r\n        const sel = [this.timeRange.start, this.timeRange.end]\r\n\r\n        const svg = d3.select('#' + this.id)\r\n\r\n        const brushEmpty = () => {\r\n          const dx = this.x(1) - this.x(0)\r\n          const [cx] = d3.mouse(document.querySelector(id + ' .brush'))\r\n          const [x0, x1] = [cx - dx / 2, cx + dx / 2]\r\n          const [X0, X1] = this.x.range()\r\n          d3.select(id + ' .brush')\r\n            .call(brush.move, x1 > X1 ? [X1 - dx, X1]\r\n              : x0 < X0 ? [X0, X0 + dx] : [x0, x1])\r\n        }\r\n\r\n        const brush = d3.brushX()\r\n          .extent([[0, 0], [width, height - mBottom]])\r\n          .on('brush end', () => {\r\n            if (!d3.event.sourceEvent) return\r\n            if (!d3.event.selection) {\r\n              if (d3.event.sourceEvent.detail === 1) {\r\n                brushEmpty()\r\n              }\r\n              return\r\n            }\r\n\r\n            const d0 = d3.event.selection\r\n            svg.select('#clip-' + this.id + ' rect')\r\n              .attr('x', d0[0])\r\n              .attr('width', d0[1] - d0[0])\r\n\r\n            if (d3.event.type === 'end') {\r\n              this.timeRange = {\r\n                start: this.x.invert(d0[0]),\r\n                end: this.x.invert(d0[1]),\r\n              }\r\n            }\r\n          })\r\n\r\n        if (sel[0] >= this.data[0].key &&\r\n          sel[1] < d3.timeMinute.every(interval).offset(\r\n            this.data[this.data.length - 1].key)) {\r\n          svg.select(id + ' .brush').transition()\r\n            .call(brush.move, sel.map(this.x))\r\n          svg.select('#clip-' + this.id + ' rect')\r\n            .attr('x', sel.map(this.x)[0])\r\n            .attr('width', sel.map(this.x)[1] - sel.map(this.x)[0])\r\n        } else {\r\n          svg.select(id + ' .brush').transition().call(brush.move, null)\r\n          svg.select('#clip-' + this.id + ' rect')\r\n            .attr('x', 0)\r\n            .attr('width', 0)\r\n        }\r\n      },\r\n      draw () {\r\n        const id = '#' + this.id\r\n        const name = this.$route.name\r\n        const interval = 20\r\n        const mBottom = 20\r\n        const width = document.querySelector(id)\r\n          .getBoundingClientRect().width\r\n        const height = 134\r\n        const dimension = this.$store.state[name].timeline\r\n          .dimension(d => d.dateTime)\r\n        const group = dimension.group(d3.timeMinute.every(interval))\r\n        this.data = group.all()\r\n        const barWid = Math.round(width / this.data.length)\r\n        this.x.domain([this.data[0].key, this.data[this.data.length - 1].key])\r\n          .rangeRound([0, width])\r\n        this.y.domain([0, group.top(1)[0].value])\r\n          .range([height - mBottom, 0])\r\n        const axis = d3.axisBottom(this.x)\r\n\r\n        d3.select(id).selectAll('*').remove()\r\n\r\n        const svg = d3.select(id)\r\n          .append('svg')\r\n          .attr('class', 'timeline-filter')\r\n          .attr('width', width)\r\n          .attr('height', height)\r\n\r\n        const bars = svg.append('g').attr('class', 'bars')\r\n\r\n        bars.append('clipPath')\r\n          .attr('id', 'clip-' + this.id)\r\n          .append('rect')\r\n          .attr('height', height - mBottom)\r\n\r\n        bars.selectAll(`#${this.id} .bar`)\r\n          .data(['background', 'foreground'])\r\n          .enter()\r\n          .append('path')\r\n          .attr('class', d => d + ' bar')\r\n          .style('fill', d => d === 'background' ? '#ccc' : 'steelblue')\r\n          .datum(this.data)\r\n\r\n        bars.selectAll(`#${this.id} .foreground.bar`)\r\n          .attr('clip-path', 'url(#clip-' + this.id + ')')\r\n\r\n        bars.selectAll(`#${this.id} .bar`)\r\n          .attr('d', d => d.map(e => 'M' + this.x(e.key) + ',' +\r\n            (height - mBottom) + 'V' + this.y(e.value) +\r\n            'h' + barWid + 'V' + (height - mBottom)).join(''))\r\n\r\n        svg.append('g')\r\n          .call(axis)\r\n          .attr('class', 'axis')\r\n          .attr('transform', `translate(0, ${height - mBottom})`)\r\n\r\n        const brushEmpty = () => {\r\n          const dx = this.x(1) - this.x(0)\r\n          const [cx] = d3.mouse(document.querySelector(id + ' .brush'))\r\n          const [x0, x1] = [cx - dx / 2, cx + dx / 2]\r\n          const [X0, X1] = this.x.range()\r\n          d3.select(id + ' .brush')\r\n            .call(brush.move, x1 > X1 ? [X1 - dx, X1]\r\n              : x0 < X0 ? [X0, X0 + dx] : [x0, x1])\r\n        }\r\n\r\n        const brush = d3.brushX()\r\n          .extent([[0, 0], [width, height - mBottom]])\r\n          .on('brush end', () => {\r\n            if (!d3.event.sourceEvent) return\r\n            if (!d3.event.selection) {\r\n              if (d3.event.sourceEvent.detail === 1) {\r\n                brushEmpty()\r\n              }\r\n              return\r\n            }\r\n\r\n            const d0 = d3.event.selection\r\n            svg.select('#clip-' + this.id + ' rect')\r\n              .attr('x', d0[0])\r\n              .attr('width', d0[1] - d0[0])\r\n\r\n            if (d3.event.type === 'end') {\r\n              this.$set(this.timeRange, 'start', this.x.invert(d0[0]))\r\n              this.$set(this.timeRange, 'end', this.x.invert(d0[1]))\r\n            }\r\n          })\r\n\r\n        svg.append('g')\r\n          .call(brush)\r\n          .attr('class', 'brush')\r\n          .on('dblclick', () => {\r\n            if (d3.brushSelection(document.querySelector(id + ' .brush'))) {\r\n              brushEmpty()\r\n            } else {\r\n              d3.select(id + ' .brush').call(brush.move, this.x.range())\r\n            }\r\n          })\r\n\r\n        this.update()\r\n      },\r\n    },\r\n  }\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimeLineExt.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimeLineExt.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TimeLineExt.vue?vue&type=template&id=c0068f3e&\"\nimport script from \"./TimeLineExt.vue?vue&type=script&lang=js&\"\nexport * from \"./TimeLineExt.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VSheet } from 'vuetify/lib/components/VSheet';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VSheet,VToolbar})\n\n\n/* vuetify-loader */\nimport installDirectives from \"!../../../node_modules/vuetify-loader/lib/runtime/installDirectives.js\"\nimport Resize from 'vuetify/lib/directives/resize'\ninstallDirectives(component, {Resize})\n"],"sourceRoot":""}